# SFTP Service

This project uses NodeJS 16.x and contains an implementation of the SFTP protocol that supports interaction with the Permanent API.

## Usage

1. Install npm packages.

```
npm install
```

2. Generate a host key for your SSH server

```
ssh-keygen -f ./keys/host.key -t ed25519 -N ""
```

3. Configure your `.env`

```
cp .env.example .env
vi .env
```

4. Start the service

```
npm start
```

or, if you want to start the development environment

```
npm run dev
```

## Contributing

Contributors to this repository agree to adhere to the [Contributor Covenant Code of Conduct](CODE_OF_CONDUCT.md). To report violations, get in touch with engineers@permanent.org.

## Security

Found a vulnerability? Report this and any other security concerns to engineers@permanent.org.

## Generating a Token

Right now this project uses a bearer token which must be generated by a permanent dev for testing purposes.

If you're a permanent dev, here are the steps:

1. Get the FusionAuth client and secret.
2. Log into the demo user at the [sftp local app](https://permanent-dev.fusionauth.io/oauth2/authorize?client_id=53c713d5-ba07-472f-a79b-582767ff6d84&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%3A9000%2Fauth%2Fcallback)
3. In the URL extract the `code` value
4. POST to https://permanent-dev.fusionauth.io/oauth2/token with the following x-www-form-urlencoded body:

```
client_id: ????
client_secret: ????
code: ????
grant_type: authorization_code
redirect_uri: http://localhost:9000/auth/callback
```

## License

This code is free software licensed as [AGPLv3](LICENSE), or at your option, any final, later version published by the Free Software Foundation.
